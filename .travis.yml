sudo: required
services:
  - docker
language: node_js
node_js:
  - '6'
before_script:
  - git clone -b develop https://github.com/ONLYOFFICE/web-apps.git ../web-apps
addons:
  sonarcloud:
    organization: "onlyoffice"
    branches:
          - develop
jobs:
  include:
    - stage: SonarQube Scanner
      script:
        - sonar-scanner
    - stage: Formulas tests
      script:
        - npm install -g node-qunit-phantomjs
        - node-qunit-phantomjs cell/.unit-tests/FormulaTests.html
    - stage: Building SDK and test it by `onlyofficetestingrobot/doc-builder-testing`
      script:
        - npm install -g grunt-cli
        - npm install --prefix build
        - grunt --level=WHITESPACE_ONLY --base build --gruntfile build/Gruntfile.js
        - docker pull onlyofficetestingrobot/doc-builder-testing:develop-latest
        - travis_wait docker run -v $PWD/word:/opt/onlyoffice/documentbuilder/sdkjs/word
                                 -v $PWD/cell:/opt/onlyoffice/documentbuilder/sdkjs/cell
                                 -v $PWD/slide:/opt/onlyoffice/documentbuilder/sdkjs/slide
                                 onlyofficetestingrobot/doc-builder-testing:develop-latest
notifications:
  email:
    recipients:
      - shockwavenn@gmail.com
    on_success: never
    on_failure: always
env:
  global:
    secure: ZYgGY1S9hfVqTn+yRCc383TA6y9hZ49ytNzLYEQnXBRzHJcOx+Ld071+dh3fL6F4vez66N1DkQ193tVxY9snIirKipa33I6loOVsIwHfIoutPEJc58Py7EHmSh7Bmu4UYKAdqkPJJbGfQMBLlwcOUGZ4t8E8lJer0TPCR8B57Y50V/HuUss0xpjTAwSsUm5O22kq/BJH4wJ4TYXauEuOwkuWV+2dIRQTLkMQmeZutt9qIuMcvmWR7UNZJS3aFIfCjepF6eedA/RFLFVs6SHpC7kcw2DLr9+sfQVAGbTfINisgXNfuXb0+5ZV+HusncOPx7cUV25m9lhZ7lFLXSdXb6EXMGAQ8RSgsygt5tsLWWhHYoahOUquVNagWavtlt5qOHsJLu1pJqw/Xqg8APYZG/4qPEUEeUOuZBqacPqxOCPVZlT8B489EmtmXG7j1VAf8tj8hwEAfd8I8dCgonuBhLIfE2T2KPdCqzemzC4c2waElxgGKDnsH71eav6lo4cfaKRf9iC2nA1lI6MViHO8TLdi4adog3HAO9MvrZExkws4cOaX46xKvHYGp0UAvQfFY81Q8GfJtlVdIKCsHM8BoWls/bD0Ep+PDIRWmIHoR8MEBlbWeYq5rn4fTWQHXcRywaABD5MoUJ343RlwJUx4c4CaqlYgoCclIac4nFl/VnE=
