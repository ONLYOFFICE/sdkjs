sudo: required
services:
  - docker
language: node_js
node_js:
  - '6'
before_script:
  - git clone -b develop https://github.com/ONLYOFFICE/web-apps.git ../web-apps
addons:
  sonarcloud:
    organization: "onlyoffice"
    token:
      secure: "ymFyYCItmqlNIhSIaI9FYrI2tlSTI8l09o7HLoJ56+BE6GNPiR/6MnCki/hMi3KXFUwGtmArL8jN2nFfVyQ8joeIEcrY/ZtIty5UtSzqzzLQPnTo9V2eNqRAKaHUEmU3OapTBt2E7XULR9U0XEjLRbCjRTOunSTrInhzTWxmAzVvDo3PPw++B1wgwdxKbUdFSooXW1iXieNP9KruKNhCWNf9jpnb4XEWqTjnsM7ICwNgLAyyEOjcNgOTVEze6E6Rg16P/wyqDsatKL+xX/dWkxCiyzTUjD0BYXyvocse0vGpr08NKFEs9OVbRdv4iwNTQSTgAoCfuEvdkmpAUNJfurxklqJsXLoG3YFjPJnxuery2VR2sFPbx7CZ5Lq78sqc9msgo0I2w/KOnHjAh6yviQffoc3gw6dm21vruz+0spnAXu5/cP/7PFc17bCTPWaM4IIBmb7Fz9HlwRBalwcUyx1dlqRJPrKEle8QmiRkNCEI4G/otT24K7lWFCpXYF2UH/vAwNsa6keypLFZrsj+Q1SZtPI42UjZH/dGgxb0eZbdkfSWQCqtxXCUszdBoAcD8AEYwV0ft69Ecs+yHmSVataI9YUzZ8lxuBM4vGLxuzQR4YnS0LBZ1/P4qwVR2Iw7iPXxvNVtnA5Cj8GI7fVyHOcO4K8HzHHtMuzrS/OajqA="
    github_token:
      secure: "f0G+YY4Lc3o0HZcNPBi5an6ZKnAKWrvHlrtFGqOOqQ9nIg9RaC5pWwlajvNU0N+fECYosiCBLydSF34RYZq1takVngK9f1gJtXtslLxqautyvRExQbDR/VYqiYM1comCvmGYcWh/cyLRTciQGQCmEy5M/Am5iLL15qPG00YIZ7udobfh3dGWx4MRH0hP7MESR5JJgJheMtj6K5MyYMG0DosQCY83/MwuBrOQMsMTQaqTpWjRoTBjYKqT4XSOFUiYeRcCVZnpq7qUglabKdOzqSvFyFAtOWQuJcgPz1+6j9hK/nYi5FTq7AWDYlXPMVZmkcYaXG7jQFwJWm3twgnFtoZaIBmlr8vj6wM+FpECms8aWBhgw3TyZVTWP4Eor9zA1oZdJ+x6L8tKGGDaIwHA45Q1sdrPUGM3VfaQ4y70i6VQ9dJQroIjFmp0uYpVpHUY+stYuvMwOWQlCUDVRLQz/aj/B3nltMjtmm1s7bqxQpfv27kRinG8vs7I3Vt/sd871DQPsNazZMXzzf57nHtse8+CLIgQCtQ30avBc58KitAuDGqTl6YmA0vWVd9dW/2ylfeAuqpO2Au1R3ntndIe0MiqAlPTbbfCcSid+rMnbr8OtQRY14y3o50QS4ehnjSC0dubO+N9WjzbYRU4ePM6dUiUkvIesR8BnqOAMdaYjtQ="
    branches:
     - develop
jobs:
  include:
    - stage: SonarQube Scanner
      script:
        - sonar-scanner
    - stage: Formulas tests
      script:
        - npm install -g node-qunit-phantomjs
        - node-qunit-phantomjs cell/.unit-tests/FormulaTests.html
    - stage: Building SDK and test it by `onlyofficetestingrobot/doc-builder-testing`
      script:
        - npm install -g grunt-cli
        - npm install --prefix build
        - grunt --level=WHITESPACE_ONLY --base build --gruntfile build/Gruntfile.js
        - docker pull onlyofficetestingrobot/doc-builder-testing:develop-latest
        - travis_wait docker run -v $PWD/word:/opt/onlyoffice/documentbuilder/sdkjs/word
                                 -v $PWD/cell:/opt/onlyoffice/documentbuilder/sdkjs/cell
                                 -v $PWD/slide:/opt/onlyoffice/documentbuilder/sdkjs/slide
                                 onlyofficetestingrobot/doc-builder-testing:develop-latest
notifications:
  email:
    recipients:
      - shockwavenn@gmail.com
    on_success: never
    on_failure: always
