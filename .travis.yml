sudo: required
services:
  - docker
language: node_js
node_js:
  - '6'
before_script:
  - git clone -b develop https://github.com/ONLYOFFICE/web-apps.git ../web-apps
addons:
  sonarcloud:
    organization: "onlyoffice"
    token:
      secure: "ymFyYCItmqlNIhSIaI9FYrI2tlSTI8l09o7HLoJ56+BE6GNPiR/6MnCki/hMi3KXFUwGtmArL8jN2nFfVyQ8joeIEcrY/ZtIty5UtSzqzzLQPnTo9V2eNqRAKaHUEmU3OapTBt2E7XULR9U0XEjLRbCjRTOunSTrInhzTWxmAzVvDo3PPw++B1wgwdxKbUdFSooXW1iXieNP9KruKNhCWNf9jpnb4XEWqTjnsM7ICwNgLAyyEOjcNgOTVEze6E6Rg16P/wyqDsatKL+xX/dWkxCiyzTUjD0BYXyvocse0vGpr08NKFEs9OVbRdv4iwNTQSTgAoCfuEvdkmpAUNJfurxklqJsXLoG3YFjPJnxuery2VR2sFPbx7CZ5Lq78sqc9msgo0I2w/KOnHjAh6yviQffoc3gw6dm21vruz+0spnAXu5/cP/7PFc17bCTPWaM4IIBmb7Fz9HlwRBalwcUyx1dlqRJPrKEle8QmiRkNCEI4G/otT24K7lWFCpXYF2UH/vAwNsa6keypLFZrsj+Q1SZtPI42UjZH/dGgxb0eZbdkfSWQCqtxXCUszdBoAcD8AEYwV0ft69Ecs+yHmSVataI9YUzZ8lxuBM4vGLxuzQR4YnS0LBZ1/P4qwVR2Iw7iPXxvNVtnA5Cj8GI7fVyHOcO4K8HzHHtMuzrS/OajqA="
    branches:
     - develop
jobs:
  include:
    - stage: SonarQube Scanner
      script:
        - sonar-scanner
    - stage: Formulas tests
      script:
        - npm install -g node-qunit-phantomjs
        - node-qunit-phantomjs cell/.unit-tests/FormulaTests.html
    - stage: Building SDK and test it by `onlyofficetestingrobot/doc-builder-testing`
      script:
        - npm install -g grunt-cli
        - npm install --prefix build
        - grunt --level=WHITESPACE_ONLY --base build --gruntfile build/Gruntfile.js
        - docker pull onlyofficetestingrobot/doc-builder-testing:develop-latest
        - travis_wait docker run -v $PWD/word:/opt/onlyoffice/documentbuilder/sdkjs/word
                                 -v $PWD/cell:/opt/onlyoffice/documentbuilder/sdkjs/cell
                                 -v $PWD/slide:/opt/onlyoffice/documentbuilder/sdkjs/slide
                                 onlyofficetestingrobot/doc-builder-testing:develop-latest
notifications:
  email:
    recipients:
      - shockwavenn@gmail.com
    on_success: never
    on_failure: always
env:
  global:
    secure: wC+umfjaNW4L0yt9N4nV2gLrLa3ajVbfmEakv4Oou58OWUa5eiMc38+hqVXDe6H7bzS0gvdCnnXso89rKQSzl3FlQ2qGYpPQcIuhTWi0j14AE5tfIYR6XcxGgKKYHYdEQ6HgIKq+gL1tizk340RCLuyqhzr3q4xghnUmoxlv/AAg9hz1jGLIYJ91mjLOAT0rSw67EUxeJk2W7Xk5rN3HxxI6vLmZF0rJjc5kvZhmVdELCq7hHbupyCYPnaB6tWKsI1XqSk5wdXvoTgEegPJ3gF9J5mxOqrC2A1vAtpA6lrcGFBx0Bt98vIHlSMwuESvhzmQlP+7wnknlXUsAjY7WRKiskgD0Y394cS9jgzb7qzTqYRDxQwBW/+sXTHTM0+CyK8Aon1LtFjrkRLiKP7M/3YoVpl3YmDhyDE28fHAGJnkudPmqbYoFsWpZmhRv3KqQj2rR9h1xLGMsJx6YudxuqzTUl8Dr+W51bB0bJzWxxJTnB4UIA0yhuKH+oSE8Fk7v+v+rORmQoaZ1v28J8rLGDMmgnsidaI7UrirbOCaDJdEErP5C3hha3DxfMblwj5MgL4y4HyLF3a381Tvv7oe+Ow8LAAKs18RUpVNMP4rF3izYcu12kFjtgY1yoc5Dkykhk/R00iHgosUf1HwpfY7L+hqPDnsxh09SvDUvVoIxAKY=
